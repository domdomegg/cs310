{"version":3,"sources":["../../language/dist/index.js","../../algorithm-w/dist/index.js","ASTView.tsx","ResultView.tsx","Main.tsx","index.tsx"],"names":["__extends","this","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","prototype","hasOwnProperty","call","__","constructor","create","__spreadArrays","s","i","il","arguments","length","r","k","a","j","jl","defineProperty","exports","value","typeUtils","ParseError","parse","PolyType","TypeFuncApp","TypeVar","Let","Abs","App","Var","NumberLiteral","CharLiteral","masala_parser_1","require","pos","notes","toString","name","fun","arg","func","param","body","def","constructorName","args","_i","map","join","quantifiedVars","monoType","v","number","char","boolean","f","one","two","extra","apply","slice","list","tuple","monoTypes","Error","bind","repeat","maybe","either","left","right","c","pt","mt","standardCtx","_super","message","_this","genlex","GenLex","identifier","tokenize","C","charIn","rep","t","charLiteral","stringLiteral","numberLiteral","N","backslash","arrow","string","lparen","rparen","letTok","equal","inTok","expression2","F","try","optApp","LEAF","or","ABS","LET","PAR","expression3","toCharArray","chars","split","getPos","expr","start","end","charPos","offset","getOffset","input","location","guessedEnd","rawString","source","trimEnd","expandPos","indexOf","lastIndexOf","drop","then","ABS_","single","lazy","at","LET_","parser","expressionPrime","array","nestLeft","optrep","reduce","prev","cur","use","eos","code","forResponse","response","Streams","ofString","isAccepted","accepted","issuePosition","__assign","assign","n","infer","unify","combine","substitute","TypeInferenceError","language_1","substitution","context","mappedContext","key","substitutions","newSubstitution","type1","type2","_a","contains","JSON","stringify","sub","diff","bset","Set","filter","has","freeVars","type","acc","values","generalise","ctx","xs","vs","forEach","x","push","unique","typeCounter","freshTypeName","_infer","steps","ast","cloneAst","e","get","highlight","Map","set","str","except","keys","logger","_b","inst","instantiatedType","_c","funcType","funcSubstitution","_d","argType","argSubstitution","unifiedSubstitution","exprType","_e","bodyType","bodySubstitution","_f","defType","defSubstitution","generalisedDefType","_g","from","to","other","some","includes","NodeView","node","hoverCallback","NodeWrapperView","className","NodeChildView","symbol","children","onMouseOver","onMouseOut","data-symbol","ASTView","createHoverCallback","setHighlights","otherHighlights","active","ResultView","parseResult","useMemo","useEffect","inferenceResult","step","Main","useState","setCode","highlights","onClick","placeholder","onChange","target","h","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.5d769e9b.chunk.js","sourcesContent":["\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __spreadArrays = (this && this.__spreadArrays) || function () {\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\n            r[k] = a[j];\n    return r;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.typeUtils = exports.ParseError = exports.parse = exports.PolyType = exports.TypeFuncApp = exports.TypeVar = exports.Let = exports.Abs = exports.App = exports.Var = exports.NumberLiteral = exports.CharLiteral = void 0;\nvar masala_parser_1 = require(\"@domdomegg/masala-parser\");\nvar CharLiteral = /** @class */ (function () {\n    function CharLiteral(value, pos, notes) {\n        this.value = value;\n        this.pos = pos;\n        this.notes = notes;\n    }\n    CharLiteral.prototype.toString = function () {\n        return \"'\" + this.value + \"'\";\n    };\n    return CharLiteral;\n}());\nexports.CharLiteral = CharLiteral;\nvar NumberLiteral = /** @class */ (function () {\n    function NumberLiteral(value, pos, notes) {\n        this.value = value;\n        this.pos = pos;\n        this.notes = notes;\n    }\n    NumberLiteral.prototype.toString = function () {\n        return this.value.toString();\n    };\n    return NumberLiteral;\n}());\nexports.NumberLiteral = NumberLiteral;\nvar Var = /** @class */ (function () {\n    function Var(name, pos, notes) {\n        this.name = name;\n        this.pos = pos;\n        this.notes = notes;\n    }\n    Var.prototype.toString = function () {\n        return this.name;\n    };\n    return Var;\n}());\nexports.Var = Var;\nvar App = /** @class */ (function () {\n    function App(fun, arg, pos, notes) {\n        this.func = fun;\n        this.arg = arg;\n        this.pos = pos;\n        this.notes = notes;\n    }\n    App.prototype.toString = function () {\n        return '(' + this.func.toString() + ' ' + this.arg.toString() + ')';\n    };\n    return App;\n}());\nexports.App = App;\nvar Abs = /** @class */ (function () {\n    function Abs(param, body, pos, notes) {\n        this.param = param;\n        this.body = body;\n        this.pos = pos;\n        this.notes = notes;\n    }\n    Abs.prototype.toString = function () {\n        return '(\\\\' + this.param + ' -> ' + this.body.toString() + ')';\n    };\n    return Abs;\n}());\nexports.Abs = Abs;\nvar Let = /** @class */ (function () {\n    function Let(param, def, body, pos, notes) {\n        this.param = param;\n        this.def = def;\n        this.body = body;\n        this.pos = pos;\n        this.notes = notes;\n    }\n    Let.prototype.toString = function () {\n        return '(let ' + this.param + ' = ' + this.def.toString() + ' in ' + this.body.toString() + ')';\n    };\n    return Let;\n}());\nexports.Let = Let;\nvar TypeVar = /** @class */ (function () {\n    function TypeVar(name) {\n        this.name = name;\n    }\n    TypeVar.prototype.toString = function () {\n        return this.name;\n    };\n    return TypeVar;\n}());\nexports.TypeVar = TypeVar;\nvar TypeFuncApp = /** @class */ (function () {\n    function TypeFuncApp(constructorName) {\n        var args = [];\n        for (var _i = 1; _i < arguments.length; _i++) {\n            args[_i - 1] = arguments[_i];\n        }\n        this.constructorName = constructorName;\n        this.args = args;\n    }\n    TypeFuncApp.prototype.toString = function () {\n        return this.constructorName + (this.args.length ? ' ' : '') + this.args.map(function (a) { return '(' + a.toString() + ')'; }).join(' ');\n    };\n    return TypeFuncApp;\n}());\nexports.TypeFuncApp = TypeFuncApp;\nvar PolyType = /** @class */ (function () {\n    function PolyType(quantifiedVars, monoType) {\n        this.quantifiedVars = quantifiedVars;\n        this.monoType = monoType;\n    }\n    PolyType.prototype.toString = function () {\n        return (this.quantifiedVars.length ? (this.quantifiedVars.map(function (v) { return '∀' + v; }).join('') + ': ') : '') + this.monoType.toString();\n    };\n    return PolyType;\n}());\nexports.PolyType = PolyType;\n/* Type utilities */\n// Utilities which make creating types easier\nvar number = new TypeFuncApp('number');\nvar char = new TypeFuncApp('char');\nvar boolean = new TypeFuncApp('boolean');\nvar f = function (one, two) {\n    var extra = [];\n    for (var _i = 2; _i < arguments.length; _i++) {\n        extra[_i - 2] = arguments[_i];\n    }\n    if (extra.length === 0)\n        return new TypeFuncApp('->', one, two);\n    return new TypeFuncApp('->', one, f.apply(void 0, __spreadArrays([two, extra[0]], extra.slice(1))));\n};\nvar list = function (monoType) { return new TypeFuncApp('[]', monoType); };\nvar tuple = function () {\n    var monoTypes = [];\n    for (var _i = 0; _i < arguments.length; _i++) {\n        monoTypes[_i] = arguments[_i];\n    }\n    if (monoTypes.length <= 1)\n        throw new Error('Tuple has too few elements, minimum of 2 but given ' + monoTypes.length);\n    if (monoTypes.length > 8)\n        throw new Error('Tuple has too many elements, maximum of 8 but given ' + monoTypes.length);\n    return new (TypeFuncApp.bind.apply(TypeFuncApp, __spreadArrays([void 0, ','.repeat(monoTypes.length - 1)], monoTypes)))();\n};\nvar maybe = function (monoType) { return new TypeFuncApp('Maybe', monoType); };\nvar either = function (left, right) { return new TypeFuncApp('Either', left, right); };\nvar a = new TypeVar('a');\nvar b = new TypeVar('b');\nvar c = new TypeVar('c');\nvar d = new TypeVar('d');\nvar pt = function (mt) { return new PolyType([], mt); };\n// Set up some basic things so the langauge is interesting\nvar standardCtx = {\n    // Arithmetic\n    '+': pt(f(number, number, number)),\n    '*': pt(f(number, number, number)),\n    '-': pt(f(number, number, number)),\n    '/': pt(f(number, number, number)),\n    '%': pt(f(number, number, number)),\n    'negate': pt(f(number, number)),\n    'abs': pt(f(number, number)),\n    'signum': pt(f(number, number)),\n    'even': pt(f(number, boolean)),\n    'odd': pt(f(number, boolean)),\n    // Booleans\n    'not': pt(f(boolean, boolean)),\n    '&&': pt(f(boolean, boolean, boolean)),\n    '||': pt(f(boolean, boolean, boolean)),\n    'True': pt(boolean),\n    'False': pt(boolean),\n    // Example variables\n    'myNumber': pt(number),\n    'myBoolean': pt(boolean),\n    // Lists\n    '[]': new PolyType(['a'], list(a)),\n    ':': new PolyType(['a'], f(a, list(a), list(a))),\n    'cons': new PolyType(['a'], f(a, list(a), list(a))),\n    '++': new PolyType(['a'], f(list(a), list(a), list(a))),\n    'head': new PolyType(['a'], f(list(a), a)),\n    'last': new PolyType(['a'], f(list(a), a)),\n    'tail': new PolyType(['a'], f(list(a), list(a))),\n    'init': new PolyType(['a'], f(list(a), list(a))),\n    'uncons': new PolyType(['a'], f(list(a), maybe(tuple(a, list(a))))),\n    'null': new PolyType(['a'], f(list(a), boolean)),\n    'length': new PolyType(['a'], f(list(a), number)),\n    'map': new PolyType(['a', 'b'], f(f(a, b), list(a), list(b))),\n    'reverse': new PolyType(['a'], f(list(a), list(a))),\n    'intersperse': new PolyType(['a'], f(a, list(a), list(a))),\n    'intercalate': new PolyType(['a'], f(list(a), list(list(a)), list(a))),\n    'transpose': new PolyType(['a'], f(list(list(a)), list(list((a))))),\n    'subsequences': new PolyType(['a'], f(list(a), list(list((a))))),\n    'permutations': new PolyType(['a'], f(list(a), list(list((a))))),\n    'foldl': new PolyType(['a'], f(f(b, a, b), b, list(a), b)),\n    'foldl\\'': new PolyType(['a'], f(f(b, a, b), b, list(a), b)),\n    'foldl1': new PolyType(['a'], f(f(a, a, a), list(a), a)),\n    'foldl1\\'': new PolyType(['a'], f(f(a, a, a), list(a), a)),\n    'foldr': new PolyType(['a'], f(f(a, b, b), b, list(a), b)),\n    'foldr1': new PolyType(['a'], f(f(a, a, a), list(a), a)),\n    'concat': new PolyType(['a'], f(list(list(a)), list(a))),\n    'concatMap': new PolyType(['a'], f(f(a, list(a)), list(a), list(b))),\n    'and': pt(f(list(boolean), boolean)),\n    'or': pt(f(list(boolean), boolean)),\n    'any': new PolyType(['a'], f(f(a, boolean), list(a), boolean)),\n    'all': new PolyType(['a'], f(f(a, boolean), list(a), boolean)),\n    'sum': pt(f(list(number), number)),\n    'product': pt(f(list(number), number)),\n    'maximum': pt(f(list(number), number)),\n    'minimum': pt(f(list(number), number)),\n    'take': new PolyType(['a'], f(number, list(a), list(a))),\n    'drop': new PolyType(['a'], f(number, list(a), list(a))),\n    'splitAt': new PolyType(['a'], f(number, list(a), tuple(list(a), list(a)))),\n    'takeWhile': new PolyType(['a'], f(f(a, boolean), list(a), list(a))),\n    'dropWhile': new PolyType(['a'], f(f(a, boolean), list(a), list(a))),\n    'elem': new PolyType(['a'], f(a, list(a), boolean)),\n    'notElem': new PolyType(['a'], f(a, list(a), boolean)),\n    'lookup': new PolyType(['a', 'b'], f(a, list(tuple(a, b)), maybe(b))),\n    'find': new PolyType(['a'], f(f(a, boolean), list(a), maybe(a))),\n    'filter': new PolyType(['a'], f(f(a, boolean), list(a), list(a))),\n    'partition': new PolyType(['a'], f(f(a, boolean), list(a), tuple(list(a), list(a)))),\n    '!!': new PolyType(['a'], f(list(a), number, a)),\n    'zip': new PolyType(['a', 'b'], f(list(a), list(b), list(tuple(a, b)))),\n    'zipWith': new PolyType(['a', 'b', 'c'], f(f(a, b, c), list(a), list(b), list(c))),\n    'unzip': new PolyType(['a', 'b'], f(list(tuple(a, b)), tuple(list(a), list(b)))),\n    'nub': new PolyType(['a'], f(list(a), list(a))),\n    'delete': new PolyType(['a'], f(a, list(a), list(a))),\n    '\\\\\\\\': new PolyType(['a'], f(list(a), list(a), list(a))),\n    'union': new PolyType(['a'], f(list(a), list(a), list(a))),\n    'intersect': new PolyType(['a'], f(list(a), list(a), list(a))),\n    'sort': new PolyType(['a'], f(list(a), list(a))),\n    // Tuples\n    ',': new PolyType(['a', 'b'], f(a, b, tuple(a, b))),\n    ',,': new PolyType(['a', 'b', 'c'], f(a, b, c, tuple(a, b, c))),\n    ',,,': new PolyType(['a', 'b', 'c', 'd'], f(a, b, c, d, tuple(a, b, c, d))),\n    'fst': new PolyType(['a', 'b'], f(tuple(a, b), a)),\n    'snd': new PolyType(['a', 'b'], f(tuple(a, b), b)),\n    'curry': new PolyType(['a', 'b', 'c'], f(f(tuple(a, b), c), a, b, c)),\n    'uncurry': new PolyType(['a', 'b', 'c'], f(f(a, b, c), tuple(a, b), c)),\n    // Maybe\n    'Just': new PolyType(['a'], f(a, maybe(a))),\n    'Nothing': new PolyType(['a'], maybe(a)),\n    // Either\n    'Left': new PolyType(['a', 'b'], f(a, either(a, b))),\n    'Right': new PolyType(['a', 'b'], f(b, either(a, b))),\n    // Id\n    'id': new PolyType(['a'], f(a, a)),\n};\n/* Parser */\n// expr ::= identifier # var\n//        | ( \\ identifier -> expr ) # abs\n//        | ( expr )\n//        | expr expr # app\n//        | ( let identifier = expr in expr ) # let\n// expr ::= identifier expr' # var\n//        | ( \\ identifier -> expr ) expr' # abs\n//        | ( expr ) expr'\n//        | ( let identifier = expr in expr ) expr' # let\n// expr' ::= expr A' | eps # app\nvar ParseError = /** @class */ (function (_super) {\n    __extends(ParseError, _super);\n    function ParseError(message) {\n        var _this = _super.call(this, message) || this;\n        _this.name = \"ParseError\";\n        return _this;\n    }\n    return ParseError;\n}(Error));\nexports.ParseError = ParseError;\nvar genlex = new masala_parser_1.GenLex();\nvar identifier = genlex.tokenize(masala_parser_1.C.charIn('abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789*+-/%<>^:[]_|&,').rep().map(function (t) { return t.join(); }), 'identifier');\nvar charLiteral = genlex.tokenize(masala_parser_1.C.charLiteral(), 'char');\nvar stringLiteral = genlex.tokenize(masala_parser_1.C.stringLiteral(), 'string');\nvar numberLiteral = genlex.tokenize(masala_parser_1.N.number(), 'number');\nvar backslash = genlex.tokenize(masala_parser_1.C.char('\\\\'), 'backslash');\nvar arrow = genlex.tokenize(masala_parser_1.C.string('->'), 'arrow');\nvar lparen = genlex.tokenize(masala_parser_1.C.char('('), 'lparen');\nvar rparen = genlex.tokenize(masala_parser_1.C.char(')'), 'rparen');\nvar letTok = genlex.tokenize(masala_parser_1.C.string('let'), 'let');\nvar equal = genlex.tokenize(masala_parser_1.C.char('='), 'equal');\nvar inTok = genlex.tokenize(masala_parser_1.C.string('in'), 'in');\nvar expression1 = function () {\n    return masala_parser_1.F.try(LET_())\n        .or(masala_parser_1.F.try(ABS_()))\n        .or(masala_parser_1.F.try(expression2()));\n};\nvar expression2 = function () {\n    return masala_parser_1.F.try(optApp(LEAF()))\n        .or(masala_parser_1.F.try(optApp(ABS())))\n        .or(masala_parser_1.F.try(optApp(LET())))\n        .or(masala_parser_1.F.try(optApp(PAR())));\n};\nvar expression3 = function () {\n    return masala_parser_1.F.try(LEAF())\n        .or(masala_parser_1.F.try(ABS()))\n        .or(masala_parser_1.F.try(LET()))\n        .or(masala_parser_1.F.try(PAR()));\n};\nvar toCharArray = function (string, r) {\n    var chars = string.split('');\n    var pos = getPos(r);\n    var expr = new Var('[]', { start: pos.end - 1, end: pos.end });\n    for (var i = chars.length - 1; i >= 0; i--) {\n        var charPos = { start: pos.start + 1 + i, end: pos.start + 2 + i };\n        expr = new App(new App(new Var(':', charPos), new CharLiteral(chars[i], charPos), charPos), expr, { start: pos.start + 1 + i, end: pos.end - 1 });\n    }\n    expr.pos.start = pos.start;\n    expr.pos.end = pos.end;\n    return expr;\n};\nvar getPos = function (r) {\n    var offset = r.getOffset() - 1;\n    var start = r.input.location(offset);\n    var guessedEnd = r.input.location(offset + 1);\n    var rawString = r.input.source.input.source.slice(start, guessedEnd);\n    var end = guessedEnd - (rawString.length - rawString.trimEnd().length);\n    return { start: start, end: end };\n};\nvar expandPos = function (v, r) {\n    var rawString = r.input.source.input.source;\n    v.pos.end += rawString.slice(v.pos.end).indexOf(')') + 1;\n    v.pos.start = rawString.slice(0, v.pos.start).lastIndexOf('(');\n    return v;\n};\n// We have to SHOUT as var and let are restricted keywords in JavaScript\nvar LEAF = function () { return masala_parser_1.F.try(numberLiteral.map(function (value, r) { return new NumberLiteral(value, getPos(r)); })).or(masala_parser_1.F.try(stringLiteral.map(toCharArray))).or(masala_parser_1.F.try(charLiteral.map(function (value, r) { return new CharLiteral(value, getPos(r)); }))).or(masala_parser_1.F.try(identifier.map(function (value, r) { return new Var(value, getPos(r)); }))); };\nvar ABS = function () { return lparen.drop().then(ABS_()).then(rparen.drop()).single().map(expandPos); };\nvar ABS_ = function () { return backslash.map(function (v, r) { return r.location() - 1; }).then(identifier).then(arrow.drop()).then(masala_parser_1.F.lazy(expression2)).map(function (tuple, r) { return new Abs(tuple.at(1), tuple.at(2), { start: tuple.at(0), end: r.location() }); }); };\nvar PAR = function () { return lparen.drop().then(masala_parser_1.F.lazy(expression2)).then(rparen.drop()).single().map(expandPos); };\nvar LET = function () { return lparen.drop().then(LET_()).then(rparen.drop()).single().map(expandPos); };\nvar LET_ = function () { return letTok.map(function (v, r) { return getPos(r).start; }).then(identifier).then(equal.drop()).then(masala_parser_1.F.lazy(expression2)).then(inTok.drop()).then(masala_parser_1.F.lazy(expression2)).map(function (tuple, r) { return new Let(tuple.at(1), tuple.at(2), tuple.at(3), { start: tuple.at(0), end: r.location() }); }); };\nvar optApp = function (parser) { return parser.then(expressionPrime()).array().map(nestLeft); };\nvar expressionPrime = function () { return masala_parser_1.F.lazy(expression3).optrep(); };\nvar nestLeft = function (v) { return v.reduce(function (prev, cur) { return new App(prev, cur, { start: prev.pos.start, end: cur.pos.end }); }); };\nvar parser = genlex.use(expression1().then(masala_parser_1.F.eos().drop()).single());\nfunction parse(code, forResponse) {\n    if (forResponse === void 0) { forResponse = false; }\n    var response = parser.parse(masala_parser_1.Streams.ofString(code));\n    if (forResponse) {\n        if (response.isAccepted())\n            return { accepted: true, value: response.value };\n        return { accepted: false, issuePosition: { start: response.location(), end: code.length }, message: 'Failed to parse' };\n    }\n    if (response.isAccepted())\n        return response.value;\n    throw new ParseError('Failed to parse:\\n\\t' + code + '\\n\\t' + ' '.repeat(response.location()) + '^');\n}\nexports.parse = parse;\nvar typeUtils = { number: number, char: char, boolean: boolean, f: f, list: list, tuple: tuple, maybe: maybe, either: either, a: a, b: b, c: c, d: d, pt: pt, standardCtx: standardCtx };\nexports.typeUtils = typeUtils;\n","\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar __spreadArrays = (this && this.__spreadArrays) || function () {\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\n            r[k] = a[j];\n    return r;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.apply = exports.infer = exports.unify = exports.combine = exports.substitute = exports.TypeInferenceError = void 0;\nvar language_1 = require(\"language\");\nvar TypeInferenceError = /** @class */ (function (_super) {\n    __extends(TypeInferenceError, _super);\n    function TypeInferenceError(message) {\n        var _this = _super.call(this, message) || this;\n        _this.name = \"TypeInferenceError\";\n        return _this;\n    }\n    return TypeInferenceError;\n}(Error));\nexports.TypeInferenceError = TypeInferenceError;\nfunction substitute(substitution, arg) {\n    var context = arg;\n    var mappedContext = {};\n    for (var key in context) {\n        mappedContext[key] = apply(context[key], substitution);\n    }\n    return mappedContext;\n}\nexports.substitute = substitute;\n/** Combines substitutions. Applies leftmost substitution first, e.g. combine(a, b).apply(e) == e.apply(a).apply(b) */\nfunction combine() {\n    var substitutions = [];\n    for (var _i = 0; _i < arguments.length; _i++) {\n        substitutions[_i] = arguments[_i];\n    }\n    if (substitutions.length === 0)\n        return {};\n    if (substitutions.length === 1)\n        return substitutions[0];\n    if (substitutions.length > 2)\n        return combine(substitutions[0], combine.apply(void 0, substitutions.slice(1)));\n    var a = substitutions[0];\n    var b = substitutions[1];\n    var newSubstitution = {};\n    for (var key in a) {\n        newSubstitution[key] = apply(a[key], b);\n    }\n    for (var key in b) {\n        if (!(key in a)) {\n            newSubstitution[key] = b[key];\n        }\n    }\n    return newSubstitution;\n}\nexports.combine = combine;\nfunction unify(type1, type2) {\n    var _a;\n    if (type1 instanceof language_1.TypeVar) {\n        if (contains(type2, type1)) {\n            throw new TypeInferenceError('Contains/occurs check failed with ' + JSON.stringify(type1) + ' and ' + JSON.stringify(type2));\n        }\n        return _a = {}, _a[type1.name] = type2, _a;\n    }\n    if (type2 instanceof language_1.TypeVar) {\n        return unify(type2, type1);\n    }\n    if (type1 instanceof language_1.TypeFuncApp && type2 instanceof language_1.TypeFuncApp) {\n        if (type1.constructorName !== type2.constructorName) {\n            throw new TypeInferenceError('Could not unify type function applications with different constructors \\'' + type1.constructorName + '\\' and \\'' + type2.constructorName + '\\'');\n        }\n        if (type1.args.length !== type2.args.length) {\n            throw new TypeInferenceError('Could not unify type function applications with different argument list lengths ' + JSON.stringify(type1) + ' and ' + JSON.stringify(type2));\n        }\n        var sub = {};\n        for (var i = 0; i < type1.args.length; i++) {\n            sub = combine(unify(apply(type1.args[i], sub), apply(type2.args[i], sub)), sub);\n        }\n        return sub;\n    }\n    // Should be unreachable...\n    throw new Error('Internal error, this should never happen');\n}\nexports.unify = unify;\nfunction unique(xs) {\n    var vs = [];\n    new Set(xs).forEach(function (x) { return vs.push(x); });\n    return vs;\n}\n/** a \\ b */\nfunction diff(a, b) {\n    var bset = new Set(b);\n    return a.filter(function (v) { return !bset.has(v); });\n}\nfunction freeVars(type) {\n    if (type instanceof language_1.PolyType) {\n        return diff(freeVars(type.monoType), type.quantifiedVars);\n    }\n    if (type instanceof language_1.TypeVar) {\n        return [type.name];\n    }\n    if (type instanceof language_1.TypeFuncApp) {\n        return type.args.map(freeVars).reduce(function (acc, cur) { return __spreadArrays(acc, cur); }, []);\n    }\n    if (type) {\n        // type: Context\n        return Object.values(type).map(freeVars).reduce(function (acc, cur) { return __spreadArrays(acc, cur); }, []);\n    }\n    // Should be unreachable...\n    throw new Error('Internal error, this should never happen');\n}\nfunction generalise(ctx, type) {\n    return new language_1.PolyType(unique(diff(freeVars(type), freeVars(ctx))), type);\n}\nfunction infer(expr, forResponse, ctx) {\n    if (forResponse === void 0) { forResponse = false; }\n    if (ctx === void 0) { ctx = language_1.typeUtils.standardCtx; }\n    var typeCounter = 0;\n    var freshTypeName = function () { return \"t\" + typeCounter++; };\n    if (!forResponse)\n        return _infer(expr, ctx, freshTypeName)[0];\n    var steps = [];\n    var logger = function (message, notes) {\n        steps.push({ message: message, ast: cloneAst(expr, notes) });\n    };\n    try {\n        return {\n            accepted: true,\n            value: {\n                type: _infer(expr, ctx, freshTypeName, logger)[0],\n                steps: steps\n            }\n        };\n    }\n    catch (e) {\n        return {\n            accepted: false,\n            issuePosition: { start: 0, end: 0 },\n            message: e.message\n        };\n    }\n}\nexports.infer = infer;\nvar cloneAst = function (expr, notes) {\n    if (expr instanceof language_1.CharLiteral)\n        return new language_1.CharLiteral(expr.value, expr.pos, notes.get(expr));\n    if (expr instanceof language_1.NumberLiteral)\n        return new language_1.NumberLiteral(expr.value, expr.pos, notes.get(expr));\n    if (expr instanceof language_1.Var)\n        return new language_1.Var(expr.name, expr.pos, notes.get(expr));\n    if (expr instanceof language_1.App)\n        return new language_1.App(cloneAst(expr.func, notes), cloneAst(expr.arg, notes), expr.pos, notes.get(expr));\n    if (expr instanceof language_1.Abs)\n        return new language_1.Abs(expr.param, cloneAst(expr.body, notes), expr.pos, notes.get(expr));\n    if (expr instanceof language_1.Let)\n        return new language_1.Let(expr.param, cloneAst(expr.def, notes), cloneAst(expr.body, notes), expr.pos, notes.get(expr));\n    // Should be unreachable...\n    throw new Error('Internal error, this should never happen');\n};\nvar highlight = function (expr) {\n    var notes = new Map();\n    notes.set(expr, 'highlight');\n    return notes;\n};\nvar str = function (substitution, except) { return '[' + Object.keys(substitution).filter(function (k) { return k !== except; }).map(function (k) { return k + '/' + substitution[k].toString(); }).join(', ') + ']'; };\nfunction _infer(expr, ctx, freshTypeName, logger) {\n    var _a, _b;\n    if (logger === void 0) { logger = function () { }; }\n    if (expr instanceof language_1.CharLiteral) {\n        logger('We know the primitive ' + expr.toString() + ' is a char', highlight(expr));\n        return [inst(new language_1.PolyType([], new language_1.TypeFuncApp('char')), freshTypeName), {}];\n    }\n    if (expr instanceof language_1.NumberLiteral) {\n        logger('We know the primitive ' + expr.toString() + ' is a number', highlight(expr));\n        return [inst(new language_1.PolyType([], new language_1.TypeFuncApp('number')), freshTypeName), {}];\n    }\n    if (expr instanceof language_1.Var) {\n        var type = ctx[expr.name];\n        if (!type) {\n            throw new TypeInferenceError(expr.name + ' is not in scope');\n        }\n        var instantiatedType = inst(type, freshTypeName);\n        logger('We can look up the variable ' + expr.toString() + ' and find it has type: ' + type.toString() + (type.quantifiedVars.length ? '\\nWe instatiate this type with fresh type variables to get: ' + instantiatedType.toString() : ''), highlight(expr));\n        return [instantiatedType, {}];\n    }\n    if (expr instanceof language_1.App) {\n        var _c = _infer(expr.func, ctx, freshTypeName, logger), funcType = _c[0], funcSubstitution = _c[1];\n        var _d = _infer(expr.arg, substitute(funcSubstitution, ctx), freshTypeName, logger), argType = _d[0], argSubstitution = _d[1];\n        var t = new language_1.TypeVar(freshTypeName());\n        var unifiedSubstitution = unify(apply(funcType, argSubstitution), new language_1.TypeFuncApp(\"->\", argType, t));\n        var exprType = apply(t, unifiedSubstitution);\n        // TODO: try and make these more similar?\n        // The problem is that the first one is much easier to read and understand, but the second is more general and covers the case where the funcType is just a Var\n        if (funcType instanceof language_1.TypeFuncApp) {\n            logger('In function application, the function must accept the expected argument type.\\nBefore unification, the function has type: ' + funcType.toString() + '\\n\\nTherefore we unify:\\nFunction accepts: ' + funcType.args[0].toString() + '\\nArgument has type: ' + argType.toString() + '\\n\\nThis gives the substitution: ' + str(unifiedSubstitution, t.name) + '\\nAnd the function\\'s return type as: ' + exprType.toString(), highlight(expr));\n        }\n        else {\n            logger('In function application, the function must accept the expected argument type and returns some other type.\\n\\nTherefore we unify:\\nFunction: ' + funcType.toString() + '\\nArgument to fresh type: ' + new language_1.TypeFuncApp(\"->\", argType, t).toString() + '\\n\\nThis gives the substitution: ' + str(unifiedSubstitution) + '\\nAnd the function\\'s return type as: ' + exprType.toString(), highlight(expr));\n        }\n        return [exprType, combine(funcSubstitution, argSubstitution, unifiedSubstitution)];\n    }\n    if (expr instanceof language_1.Abs) {\n        var t = new language_1.TypeVar(freshTypeName());\n        logger('Our function definition binds ' + expr.param + ' in the body to the fresh type: ' + t.toString(), highlight(expr));\n        var _e = _infer(expr.body, __assign(__assign({}, ctx), (_a = {}, _a[expr.param] = new language_1.PolyType([], t), _a)), freshTypeName, logger), bodyType = _e[0], bodySubstitution = _e[1];\n        var type = apply(new language_1.TypeFuncApp(\"->\", t, bodyType), bodySubstitution);\n        logger((bodySubstitution[t.name] ? 'We apply the substitution [' + t.name + '/' + bodySubstitution[t.name].toString() + '] to get the parameter\\'s type: ' + type.args[0].toString() + '.\\n' : '') + 'The return type is given by the function body\\'s type: ' + type.args[1].toString() + '\\nTherefore the overall type is: ' + type.toString(), highlight(expr));\n        return [type, bodySubstitution];\n    }\n    if (expr instanceof language_1.Let) {\n        var _f = _infer(expr.def, ctx, freshTypeName, logger), defType = _f[0], defSubstitution = _f[1];\n        var generalisedDefType = generalise(substitute(defSubstitution, ctx), defType);\n        logger('Our let statement binds ' + expr.param + ' in the body to the type: ' + generalisedDefType.toString(), highlight(expr));\n        var _g = _infer(expr.body, __assign(__assign({}, substitute(defSubstitution, ctx)), (_b = {}, _b[expr.param] = generalisedDefType, _b)), freshTypeName, logger), bodyType = _g[0], bodySubstitution = _g[1];\n        logger('Our let statement then takes its body\\'s type: ' + bodyType.toString(), highlight(expr));\n        return [bodyType, combine(defSubstitution, bodySubstitution)];\n    }\n    // Should be unreachable...\n    throw new Error('Internal error, this should never happen');\n}\nfunction inst(type, freshTypeName, from, to) {\n    if (from === void 0) { from = []; }\n    if (to === void 0) { to = []; }\n    if (type instanceof language_1.TypeVar) {\n        var i = from.indexOf(type.name);\n        return (i === -1) ? type : new language_1.TypeVar(to[i]);\n    }\n    if (type instanceof language_1.TypeFuncApp) {\n        return new (language_1.TypeFuncApp.bind.apply(language_1.TypeFuncApp, __spreadArrays([void 0, type.constructorName], type.args.map(function (arg) { return inst(arg, freshTypeName, from, to); }))))();\n    }\n    if (type instanceof language_1.PolyType) {\n        return inst(type.monoType, freshTypeName, type.quantifiedVars, type.quantifiedVars.map(freshTypeName));\n    }\n    // Should be unreachable...\n    throw new Error('Internal error, this should never happen');\n}\nfunction apply(type, substitution) {\n    if (type instanceof language_1.TypeVar) {\n        return type.name in substitution ? substitution[type.name] : type;\n    }\n    if (type instanceof language_1.TypeFuncApp) {\n        return new (language_1.TypeFuncApp.bind.apply(language_1.TypeFuncApp, __spreadArrays([void 0, type.constructorName], type.args.map(function (arg) { return apply(arg, substitution); }))))();\n    }\n    if (type instanceof language_1.PolyType) {\n        return new language_1.PolyType(type.quantifiedVars, apply(type.monoType, substitution));\n    }\n    // Should be unreachable...\n    throw new Error('Internal error, this should never happen');\n}\nexports.apply = apply;\nfunction contains(type, other) {\n    if (type instanceof language_1.TypeVar) {\n        return type.name == other.name;\n    }\n    if (type instanceof language_1.TypeFuncApp) {\n        return type.args.some(function (arg) { return contains(arg, other); });\n    }\n    if (type instanceof language_1.PolyType) {\n        return contains(type.monoType, other) && !type.quantifiedVars.includes(other.name);\n    }\n    // Should be unreachable...\n    throw new Error('Internal error, this should never happen');\n}\n","import React, { ReactNode } from 'react';\nimport { Expr, Var, App, Abs, Let, NumberLiteral, CharLiteral } from 'language'\n\ntype HoverCallback = (active: boolean, p: { start: number, end: number }) => void; \n\nfunction ASTView({ ast, hoverCallback }: { ast: Expr, hoverCallback: HoverCallback }) {\n    return <div className=\"ast-view\"><NodeView node={ast} hoverCallback={hoverCallback} /></div>\n}\n\nfunction NodeView({ node, hoverCallback }: { node: Expr, hoverCallback: HoverCallback }) {\n    if (node instanceof CharLiteral || node instanceof NumberLiteral) {\n        return <NodeWrapperView node={node} hoverCallback={hoverCallback}>{node.value}</NodeWrapperView>;\n    }\n\n    if (node instanceof Var) {\n        return <NodeWrapperView node={node} hoverCallback={hoverCallback}>{node.name}</NodeWrapperView>;\n    }\n\n    if (node instanceof App) {\n        return <>\n            <NodeWrapperView node={node} hoverCallback={hoverCallback}><span className=\"sans-serif\">Function application</span></NodeWrapperView>\n            <NodeChildView><NodeView node={node.func} hoverCallback={hoverCallback} /></NodeChildView>\n            <NodeChildView><NodeView node={node.arg} hoverCallback={hoverCallback}/></NodeChildView>\n        </>;\n    }\n\n    if (node instanceof Abs) {\n        return <>\n            <NodeWrapperView node={node} hoverCallback={hoverCallback}>λ{node.param}</NodeWrapperView>\n            <NodeChildView symbol='->'><NodeView node={node.body} hoverCallback={hoverCallback}/></NodeChildView>\n        </>\n    }\n\n    if (node instanceof Let) {\n        return <>\n            <NodeWrapperView node={node} hoverCallback={hoverCallback}>let {node.param}</NodeWrapperView>\n            <NodeChildView symbol='='><NodeView node={node.def} hoverCallback={hoverCallback}/></NodeChildView>\n            <NodeChildView symbol='in'><NodeView node={node.body} hoverCallback={hoverCallback}/></NodeChildView>\n        </>\n    }\n\n    throw new Error('Attempted to display a node of invalid type ' + typeof node);\n}\n\nfunction NodeWrapperView({ children, node, hoverCallback }: { children: ReactNode, node: Expr, hoverCallback: HoverCallback }) {\n    return <div className={\"ast-node \" + (node.notes || '')} onMouseOver={() => hoverCallback(true, node.pos)} onMouseOut={() => hoverCallback(false, node.pos)}>{children}</div>;\n}\n\nfunction NodeChildView({ children, symbol }: { children: ReactNode, symbol?: string }) {\n    return <div className=\"ast-child\" data-symbol={symbol}>{children}</div>\n}\n\nexport default ASTView;","import React, { useMemo, useEffect } from 'react';\nimport { parse } from 'language'\nimport { infer } from 'algorithm-w'\nimport ASTView from './ASTView';\n\nexport interface Highlight {\n  start: number;\n  end: number;\n  className: string;\n}\n\nfunction ResultView({ code, setHighlights }: { code: string, setHighlights: (h: Highlight[]) => void }) {\n  // Parse the code, highlighting any errors\n  const parseResult = useMemo(() => {\n    return parse(code, true);\n  }, [code]);\n  useEffect(() => setHighlights(parseResult.accepted ? [] : [{ start: parseResult.issuePosition.start, end: parseResult.issuePosition.end, className: 'highlight-error' }]), [parseResult, setHighlights]);\n\n  // Infer the types, highlighting any errors\n  const inferenceResult = useMemo(() => {\n    if (!parseResult.accepted) return;\n    return infer(parseResult.value, true);\n  }, [parseResult])!;\n  useEffect(() => inferenceResult && setHighlights(inferenceResult.accepted ? [] : [{ start: inferenceResult.issuePosition.start, end: inferenceResult.issuePosition.end, className: 'highlight-error' }]), [inferenceResult, setHighlights]);\n\n  if (!parseResult.accepted) {\n    return <>\n      <h2>AST</h2>\n      <p>{parseResult.message}</p>\n    </>;\n  }\n\n  if (!inferenceResult.accepted) {\n    return <>\n      <h2>AST</h2>\n      <ASTView ast={parseResult.value} hoverCallback={createHoverCallback(setHighlights, [{ start: inferenceResult.issuePosition.start, end: inferenceResult.issuePosition.end || 0, className: 'highlight-error' }])} />\n\n      <h2>Type</h2>\n      <p>{inferenceResult.message}</p>\n    </>;\n  }\n\n  const hoverCallback = createHoverCallback(setHighlights, []);\n  return <>\n    <h2>AST</h2>\n    <ASTView ast={parseResult.value} hoverCallback={hoverCallback} />\n\n    <h2>Type derivation</h2>\n    {inferenceResult.value.steps.map((step, i) => <><h3>Step {i+1}</h3><p>{step.message}</p><ASTView ast={step.ast} hoverCallback={hoverCallback} /></>)}\n\n    <h2>Type</h2>\n    <p>{inferenceResult.value.type.toString()}</p>\n  </>;\n}\n\nconst createHoverCallback = (setHighlights: (h: Highlight[]) => void, otherHighlights: Highlight[]) => (active: boolean, p: { start: number, end: number }) => {\n  setHighlights(active ? [...otherHighlights, { start: p.start, end: p.end, className: 'highlight-white' }] : otherHighlights);\n}\n\nexport default ResultView;","import React, { useState } from 'react';\nimport './Main.css';\nimport ResultView, { Highlight } from './ResultView';\n\nfunction Main() {\n  const [code, setCode] = useState('map not []');\n  const [highlights, setHighlights] = useState<Highlight[]>([]);\n\n  return (\n    <>\n      <h1>interactive type inference</h1>\n      <h2>\n        Play with algorithm W in your browser.\n      </h2>\n      <h2>Samples:\n        <button onClick={() => setCode('4')}>4</button>\n        <button onClick={() => setCode('not')}>not</button>\n        <button onClick={() => setCode('not True')}>not True</button>\n        <button onClick={() => setCode('+')}>+</button>\n        <button onClick={() => setCode('map not []')}>map not []</button>\n        <button onClick={() => setCode('fst')}>fst</button>\n        <button onClick={() => setCode('Just')}>Just</button>\n        <button onClick={() => setCode('let x = 3 in + x')}>let x = 3 in + x</button>\n        <button onClick={() => setCode('\\\\x -> / x 2')}>\\x -{'>'} / x 2</button>\n        <button onClick={() => setCode('cons 23 []')}>cons 23 []</button>\n      </h2>\n      <div className='code-container'>\n        <input placeholder=\"Enter code...\" value={code} onChange={e => setCode(e.target.value)} />\n        {code && highlights.map((h, i) => <p key={i}>{code.slice(0, h.start)}<span className={h.className}>{code.slice(h.start, h.end)}</span>{code.slice(h.end)}</p>)}\n      </div>\n      {code && <ResultView code={code} setHighlights={setHighlights} />}\n    </>\n  );\n}\n\nexport default Main;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport Main from './Main';\n\nReactDOM.render(\n  <React.StrictMode>\n    <Main />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n"],"sourceRoot":""}